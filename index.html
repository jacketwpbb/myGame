<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        html, body {
            padding: 0;
            margin: 0;
        }

        #my-canvas {
            border: 1px solid #000;
            margin: 10px auto;
            display: block;
        }
    </style>
    <script src="js/utils.js"></script>
    <script src="js/game.js"></script>
    <script src="js/paddle.js"></script>
    <script src="js/block.js"></script>
    <script src="js/ball.js"></script>
    <script src="js/level.js"></script>
</head>
<body>
<canvas id="my-canvas" width="400" height="300"></canvas>
<label for="input-fps">fps</label>
<input type="range" id="input-fps" value="1" min="1">
</body>
<script>
    var loadLevel = function (n) {
        n = n - 1
        var level = levels[n]
        var blocks = []
        for (var i = 0; i < level.length; i++) {
            var p = level[i];
            var b = Block(p)
            blocks.push(b)


        }
        return blocks
    }
    var blocks
    var pause=false
    var fps=10

    var enableDebugMode=function(enable){
        if(!enable){
            return
        }
        window.addEventListener("keyup", function (event) {
            var key = event.key;
            if (event.key === "p") {
               pause = !pause
            }
            if ('1234567'.includes(key)) {
                blocks = loadLevel(key)
            }
        })
        document.querySelector('#input-fps').addEventListener("input",function(event){
            var input=event.target
            window.fps=input.value
        })
    }
    var __main = function () {

        enableDebugMode(true,game)
        var game = Game()
        var paddle = Paddle()
        var ball = Ball()
        blocks = loadLevel(1)

        game.registerAction("a", function () {
            paddle.moveLeft()
        })
        game.registerAction("d", function () {
            paddle.moveRight()
        })
        game.registerAction("f", function () {
            ball.fired = true
        })


        game.update = function () {
            if (pause) {
                return
            }
            ball.move()
            //collide
            ball.bounce(ball.collide(paddle), paddle)
            for (var i = 0; i < blocks.length; i++) {
                var block = blocks[i];
                ball.bounce(block.alive && ball.collide(block),block)
                if(ball.collide(block)){
                    block.kill()
                }

            }


        }

        game.draw = function () {
            game.drawImage(ball)
            game.drawImage(paddle)
            for (var i = 0; i < blocks.length; i++) {
                var b = blocks[i];
                if (b.alive) {
                    game.drawImage(b)
                }

            }


        }

    }
    __main()

</script>
</html>